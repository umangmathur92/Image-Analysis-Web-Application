(function(f,g){var d;var c;var l;var b;var m={};var q=false;var i={white:"#ffffff",black:"#000000",overlay:"rgba(0, 0, 0, 0.6)"};var p;function j(){c.clearRect(0,0,d.width,d.height);if(l===g){return}var z=m;c.drawImage(l,0,0,z.width,z.height);if(q){r();var u=p.x+p.width-5,B=p.y+p.height-5,v=p.resizerSide,A=p.resizerSide;c.save();c.fillStyle=i.black;c.strokeStyle=i.white;c.fillRect(u,B,v,A);c.strokeRect(u,B,v,A);c.restore()}}function r(){c.save();c.fillStyle=i.overlay;c.beginPath();c.moveTo(0,0);c.lineTo(p.x,p.y);c.lineTo(p.x+p.width,p.y);c.lineTo(d.width,0);c.moveTo(d.width,0);c.lineTo(p.x+p.width,p.y);c.lineTo(p.x+p.width,p.y+p.height);c.lineTo(d.width,d.height);c.moveTo(d.width,d.height);c.lineTo(p.x+p.width,p.y+p.height);c.lineTo(p.x,p.y+p.height);c.lineTo(0,d.height);c.moveTo(0,d.height);c.lineTo(p.x,p.y+p.height);c.lineTo(p.x,p.y);c.lineTo(0,0);c.fill();c.restore()}function n(u){p.ratioXY=u;p.height=Math.floor(p.width*u)}function s(x,u){var w=1;if((d.width-x)<(d.height-u)){w=d.width/x}else{w=d.height/u}var v={width:Math.floor(x*w),height:Math.floor(u*w),factor:w};return v}function e(u,v){return u>p.x&&u<(p.x+p.width)&&v>p.y&&v<(p.y+p.height)}function k(u,v){return u>(p.x+p.width-p.resizerSide)&&u<(p.x+p.width+p.resizerSide)&&v>(p.y+p.height-p.resizerSide)&&v<(p.y+p.height+p.resizerSide)}var o={type:"",inProgress:false,originalOverlayX:0,originalOverlayY:0,originalX:0,originalY:0,originalOverlayWidth:0,originalOverlayHeight:0};function h(){d.onmousedown=function(v){var w=d.getMouseCoords(v);var u=w.x;var z=w.y;if(e(u,z)){o.type="moveOverlay";o.inProgress=true;o.originalOverlayX=u-p.x;o.originalOverlayY=z-p.y}if(k(u,z)){o.type="resizeOverlay";o.inProgress=true;o.originalX=u;o.originalY=z;o.originalOverlayWidth=p.width;o.originalOverlayHeight=p.height}};d.onmouseup=function(u){o.inProgress=false};d.onmouseout=function(u){o.inProgress=false};d.onmousemove=function(v){var z=d.getMouseCoords(v);var u=z.x;var B=z.y;if(k(u,B)||(o.inProgress&&o.type==="resizeOverlay")){d.style.cursor="nwse-resize"}else{if(e(u,B)){d.style.cursor="move"}else{d.style.cursor="auto"}}if(!o.inProgress){return}if(o.type==="moveOverlay"){p.x=u-o.originalOverlayX;p.y=B-o.originalOverlayY;var A=d.width-p.width;var w=d.height-p.height;if(p.x<0){p.x=0}else{if(p.x>A){p.x=A}}if(p.y<0){p.y=0}else{if(p.y>w){p.y=w}}j()}else{if(o.type==="resizeOverlay"){p.width=o.originalOverlayWidth+(u-o.originalX);if(p.width<10){p.width=10}if(p.x+p.width>d.width){p.width=d.width-p.x}p.height=p.width*p.ratioXY;if(p.y+p.height>d.height){p.height=d.height-p.y;p.width=p.height/p.ratioXY}j()}}}}function t(B){if(l===g){return false}if(!q){B=true}var v=0;var D=0;var A=l.width;var u=l.height;if(!B){var z=m.factor;v=Math.floor(p.x/z);D=Math.floor(p.y/z);A=Math.floor(p.width/z);u=Math.floor(p.height/z);if(v<0){v=0}if(v>l.width){v=l.width}if(D<0){D=0}if(D>l.height){D=l.height}if(v+A>l.width){A=l.width-v}if(D+u>l.height){u=l.height-D}}var w=document.createElement("canvas");w.setAttribute("width",A);w.setAttribute("height",u);var C=w.getContext("2d");C.drawImage(l,v,D,A,u,0,0,A,u);return w}function a(v){var z=atob(v.split(",")[1]);var u=v.split(",")[0].split(":")[1].split(";")[0];var y=new ArrayBuffer(z.length);var w=new Uint8Array(y);for(var x=0;x<z.length;x++){w[x]=z.charCodeAt(x)}return new Blob([w],{type:u})}f.showImage=function(u){q=false;l=new Image();l.onload=function(){m=s(l.width,l.height);j()};l.src=u};f.startCropping=function(){if(l===g){return false}b=new Image();b.src=l.src;q=true;j();return true};f.getCroppedImageSrc=function(){if(l){var v=t(!q);var u=v.toDataURL("png");if(q){f.showImage(u)}q=false;return u}else{return false}};f.getCroppedImageBlob=function(w){if(l){var v=t(!q);var u=v.toDataURL(w||"png");if(q){f.showImage(u)}q=false;return a(u)}else{return false}};f.start=function(u,v){d=u;if(!d.getContext){return}c=d.getContext("2d");p={x:50,y:50,width:100,height:100,resizerSide:10,ratioXY:1};if(v){n(v)}h()};f.restore=function(){if(b===g){return false}q=false;f.showImage(b.src);return true};HTMLCanvasElement.prototype.getMouseCoords=function(y){var z=0;var x=0;var v=0;var u=0;var w=this;do{z+=w.offsetLeft;x+=w.offsetTop}while(w=w.offsetParent);v=y.pageX-z;u=y.pageY-x;return{x:v,y:u}}}(window.cropper=window.cropper||{}));